<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Frontier DOOH 전국 DB</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"/>
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

  <style>
    :root{
      --bg:#0b0f14; --panel:#0f1620; --panel2:#0c121a; --line:#1b2736;
      --text:#dbe6f5; --muted:#9fb0c9; --mint:#a2decc; --mint2:#72d6bd;
      --danger:#ff5b5b;
      --card:#101a25;
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --radius:14px;
      --radius2:18px;
      --font: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", "Apple SD Gothic Neo", Arial, sans-serif;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0; font-family:var(--font); background:var(--bg); color:var(--text);
      overflow:hidden;
    }
    .topbar{
      position:sticky; top:0; z-index:20;
      display:flex; align-items:center; justify-content:space-between;
      padding:10px 14px;
      background:linear-gradient(180deg, rgba(11,15,20,.98), rgba(11,15,20,.88));
      border-bottom:1px solid rgba(162,222,204,.18);
      backdrop-filter: blur(10px);
    }
    .brand{ font-weight:800; letter-spacing:.2px; }
    .brand small{ color:var(--muted); font-weight:700; margin-left:8px; }
    .pill{
      color:var(--muted);
      font-weight:700;
      font-size:13px;
      background:rgba(255,255,255,.03);
      border:1px solid rgba(162,222,204,.18);
      padding:7px 10px;
      border-radius:999px;
    }
    .app{
      display:grid;
      grid-template-columns: 1fr 380px;
      height: calc(100vh - 52px);
      min-height: 560px;
    }
    #map{ width:100%; height:100%; background:#0b0f14; }
    .panel{
      height:100%;
      background:linear-gradient(180deg, rgba(15,22,32,.98), rgba(12,18,26,.96));
      border-left:1px solid rgba(162,222,204,.18);
      box-shadow: var(--shadow);
      display:flex;
      flex-direction:column;
    }
    .panelHead{
      padding:12px 12px 10px 12px;
      border-bottom:1px solid rgba(162,222,204,.12);
    }
    .row{ display:flex; gap:8px; align-items:center; }
    .row + .row{ margin-top:8px; }
    input[type="text"]{
      width:100%;
      background:rgba(255,255,255,.03);
      border:1px solid rgba(162,222,204,.18);
      color:var(--text);
      padding:10px 10px;
      border-radius:12px;
      font-weight:650;
      outline:none;
    }
    input[type="text"]::placeholder{ color:rgba(159,176,201,.75); }
    .btn{
      border:1px solid rgba(162,222,204,.18);
      background:rgba(255,255,255,.03);
      color:var(--text);
      padding:10px 10px;
      border-radius:12px;
      font-weight:800;
      cursor:pointer;
      user-select:none;
    }
    .btn:hover{ border-color:rgba(162,222,204,.35); }
    .btn.mint{
      border-color:rgba(162,222,204,.45);
      box-shadow: 0 0 0 1px rgba(162,222,204,.18) inset;
    }
    select{
      width:100%;
      background:rgba(255,255,255,.03);
      border:1px solid rgba(162,222,204,.18);
      color:var(--text);
      padding:10px 10px;
      border-radius:12px;
      font-weight:750;
      outline:none;
      appearance:none;
    }
    select:disabled{ opacity:.45; }
    .metaLine{
      color:var(--muted);
      font-size:12px;
      font-weight:700;
      display:flex;
      justify-content:space-between;
      margin-top:8px;
    }
    .metaLine b{ color:var(--text); }

    .listWrap{
      padding:10px 10px 12px 10px;
      overflow:auto;
      flex:1;
    }
    .card{
      background:rgba(16,26,37,.8);
      border:1px solid rgba(162,222,204,.14);
      border-radius:var(--radius);
      padding:10px 10px;
      margin-bottom:10px;
      cursor:pointer;
      transition: transform .12s ease, border-color .12s ease, box-shadow .12s ease;
    }
    .card:hover{
      transform: translateY(-1px);
      border-color: rgba(162,222,204,.35);
      box-shadow: 0 10px 22px rgba(0,0,0,.35);
    }
    .card .t{ font-weight:900; font-size:14px; }
    .card .s{ color:var(--muted); font-weight:700; font-size:12px; margin-top:4px; line-height:1.35; }
    .tagRow{
      display:flex; flex-wrap:wrap; gap:6px; margin-top:8px;
    }
    .tag{
      font-size:11px; font-weight:800;
      padding:5px 8px;
      border-radius:999px;
      background:rgba(162,222,204,.08);
      border:1px solid rgba(162,222,204,.18);
      color:var(--mint);
    }

    /* 에러 배너 */
    .errBanner{
      display:none;
      position:fixed; left:12px; right:12px; bottom:12px;
      background:rgba(255,91,91,.12);
      border:1px solid rgba(255,91,91,.45);
      color:#ffd9d9;
      padding:10px 12px;
      border-radius:14px;
      z-index:50;
      box-shadow: var(--shadow);
    }
    .errBanner .x{
      float:right; cursor:pointer; font-weight:900; opacity:.85;
    }
    .errBanner code{ color:#fff; font-weight:800; }

    /* 상세 모달 (앱에서 제어) */
    #dOverlay{ display:none; position:fixed; inset:0; z-index:60; background:rgba(0,0,0,.55); }
    #dModal{
      display:none;
      position:fixed; z-index:61;
      right:14px; top:66px;
      width: 520px; max-width: calc(100vw - 28px);
      max-height: calc(100vh - 80px);
      overflow:auto;
      background:rgba(15,22,32,.98);
      border:1px solid rgba(162,222,204,.22);
      border-radius:18px;
      box-shadow: 0 18px 44px rgba(0,0,0,.55);
      padding:12px 12px;
    }
    .dHead{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .dHead .h{ font-weight:950; }
    .dHead .x{ cursor:pointer; font-weight:900; opacity:.85; }
    .dBody{ margin-top:10px; color:var(--muted); font-weight:700; font-size:13px; line-height:1.5; }
    .dBtns{ margin-top:12px; display:flex; gap:8px; flex-wrap:wrap; }
    .dBtns .btn{ flex:1; min-width: 160px; }

    /* 클러스터 힌트 */
    #clusterHint{
      display:none;
      position:absolute;
      z-index:30;
      padding:8px 10px;
      border-radius:12px;
      background:rgba(15,22,32,.92);
      border:1px solid rgba(162,222,204,.22);
      color:var(--text);
      font-weight:800;
      box-shadow: var(--shadow);
      pointer-events:none;
      transform: translate(-50%, -120%);
      white-space:nowrap;
    }

    /* 모바일 */
    @media (max-width: 980px){
      body{ overflow:auto; }
      .app{ grid-template-columns: 1fr; height:auto; }
      #map{ height: 56vh; min-height: 360px; }
      .panel{ height:auto; border-left:none; border-top:1px solid rgba(162,222,204,.18); }
      #dModal{ left:14px; right:14px; width:auto; top:72px; }
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="brand">Frontier DOOH 전국 DB <small id="ver">v1.1.26</small></div>
    <div class="pill">Loaded: <b id="loadedCnt">0</b></div>
  </div>

  <div class="app">
    <div id="map"></div>

    <div class="panel">
      <div class="panelHead">
        <div class="row">
          <input id="q" type="text" placeholder="검색 (예: 강남역, 신촌, 롯데백화점)" autocomplete="off"/>
          <button id="btnSearch" class="btn mint">검색</button>
          <button id="btnReset" class="btn">초기화</button>
        </div>

        <div class="row">
          <select id="catGroup" class="cat catGroup" aria-label="매체 카테고리(대분류)">
            <option value="">매체 카테고리(대분류)</option>
          </select>
          <select id="catSub" class="cat catSub" aria-label="하위 카테고리" disabled>
            <option value="">하위 카테고리(전체)</option>
          </select>
        </div>

        <div class="metaLine">
          <span>전체 <b id="mAll">0</b></span>
          <span>필터 <b id="mFilter">0</b></span>
        </div>
      </div>

      <div class="listWrap">
        <div id="list"></div>
        <div id="sentinel" style="height:1px;"></div>
      </div>
    </div>
  </div>

  <div id="clusterHint"></div>

  <div class="errBanner" id="errBanner">
    <span class="x" id="errClose">닫기</span>
    <div id="errText"></div>
  </div>

  <div id="dOverlay"></div>
  <div id="dModal">
    <div class="dHead">
      <div class="h" id="dTitle">상세</div>
      <div class="x" id="dx">닫기</div>
    </div>
    <div class="dBody" id="dBody"></div>
    <div class="dBtns">
      <button id="dAddCart" class="btn mint">담기</button>
      <button id="dGoCart" class="btn">장바구니</button>
    </div>
  </div>

  <!-- 중요: 캐시 방지용 쿼리만 변경 (버전 표기 자체는 유지) -->
  <script src="./app.js?v=1.1.26-cat" defer></script>
</body>
</html>
